{% extends "layout.html" %}

{% block title %}
    Admin
{% endblock %}

{% block main %}

<div class="container colored-container">

    <!-- Static VIN Table -->
    <div class="section">
        <h2>Van Identifications (Hardcoded)</h2>
    </div>

    <!-- Search bar placed above the table -->
    <input type="text" id="searchBar" placeholder="Search">

    <table id="vanTable" class="table table-bordered">
        <thead>
            <tr>
                <th>Van</th>
                <th>VIN Number</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>G1</td><td>3C6URVJG8KE545204</td></tr>
            <tr><td>G2</td><td>3C6URVJG0LE113112</td></tr>
            <tr><td>G3</td><td>3C6URVJG1LE113135</td></tr>
            <tr><td>G4</td><td>3C6URVJG6LE112921</td></tr>
            <tr><td>G5</td><td>3C6URVJGXKE545205</td></tr>
            <tr><td>G6</td><td>3C6URVJG7KE545243</td></tr>
            <tr><td>G7</td><td>3C6URVJG7KE543721</td></tr>
            <tr><td>G8</td><td>3C6URVJG6KE553303</td></tr>
            <tr><td>G9</td><td>3C6MRVJG8ME541401</td></tr>
            <tr><td>G10</td><td>3C6URVJG5LE112909</td></tr>
            <tr><td>G11</td><td>3C6URVJG7LE117920</td></tr>
            <tr><td>G12</td><td>3C6URVJG9KE551318</td></tr>
            <tr><td>G13</td><td>3C6URVJG0KE551384</td></tr>
            <tr><td>G14</td><td>3C6URVJG9LE113156</td></tr>
            <tr><td>G15</td><td>3C6URVJG9LE116686</td></tr>
            <tr><td>G16</td><td>3C6URVJG3KE551296</td></tr>
            <tr><td>G17</td><td>3C6URVJG3KE546664</td></tr>
            <tr><td>G18</td><td>3C6URVJG9LE113142</td></tr>
            <tr><td>G19</td><td>3C6URVJGXKE551327</td></tr>
            <tr><td>G20</td><td>3C6URVJG9KE541677</td></tr>
            <tr><td>G21</td><td>3C6URVJG2LE113144</td></tr>
            <tr><td>G22</td><td>3C6URVJG8LE117182</td></tr>
            <tr><td>G23</td><td>3C6URVJGXLE113117</td></tr>
            <tr><td>G24</td><td>1FTBR3X80LKB28176</td></tr>
            <tr><td>G25</td><td>3C6URVJG0LE144389</td></tr>
            <tr><td>G26</td><td>1FTBR3X81LKB33385</td></tr>
            <tr><td>---</td><td>-----------------</td></tr>
            <tr><td>G53</td><td>3C6LRVBG4NE139466</td></tr>
            <tr><td>G54</td><td>3C6LRVBG8NE139468</td></tr>
            <tr><td>G55</td><td>3C6LRVBG6NE139467</td></tr>
            <tr><td>G56</td><td>3C6TRVBG3LE134868</td></tr>
            <tr><td>G57</td><td>3C6TRVBG5LE134869</td></tr>            
        </tbody>
    </table>

    <hr>

    <!-- Dynamic Van Management (Database-based) -->
    <h2>Manage Vans (Live)</h2>

    <!-- Add New Van -->
    <form action="/admin/add" method="post" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <input type="text" name="label" class="form-control" placeholder="Van Label (e.g., L5)" required>
            </div>
            <div class="col-md-6">
                <input type="text" name="vin" class="form-control" placeholder="VIN Number" required>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Add Van</button>
            </div>
        </div>
    </form>

    <!-- Editable Table -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Van</th>
                <th>VIN</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for van in vans %}
            <tr>
                <form action="/admin/update" method="post">
                    <input type="hidden" name="id" value="{{ van.id }}">
                    <td><input type="text" name="label" value="{{ van.label }}" class="form-control" required></td>
                    <td><input type="text" name="vin" value="{{ van.vin }}" class="form-control" required></td>
                    <td>
                        <button type="submit" class="btn btn-success btn-sm">Update</button>
                        <a href="/admin/delete/{{ van.id }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete</a>
                    </td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- 🔍 Search bar script (unchanged) -->
<script>
    document.getElementById('searchBar').addEventListener('input', function () {
        var query = this.value.toUpperCase();
        var rows = document.getElementById('vanTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');

        for (var i = 0; i < rows.length; i++) {
            var cols = rows[i].getElementsByTagName('td');
            var rowMatchesQuery = false;
            var columnsToCheck = [0, 1];

            for (var j = 0; j < columnsToCheck.length; j++) {
                var cellText = cols[columnsToCheck[j]].innerText.toUpperCase();
                if (cellText.includes(query)) {
                    rowMatchesQuery = true;
                    break;
                }
            }

            rows[i].style.display = rowMatchesQuery ? '' : 'none';
        }
    });
</script>

{% endblock %}
